---
garage_witb:
  # WITB+ Actions Package Template
  # Tokens: garage, Garage
  #
  # Feature blocks (controlled by --no-X flags or per-room `no_X: true` in config):
  #   lights     - brightness helpers + auto_lights_on boolean + keep_on boolean
  #   fan        - fan speed/delay/runon helpers + auto_fan_on boolean + fan timers
  #   lux        - lux threshold input_number
  #   humidity   - humidity high/low input_numbers
  #   night      - night start/end input_datetime helpers
  #   exit_eval  - timer.garage_exit_eval (required by WITB+ v4.2)
  #
  # CHANGELOG:
  #   - Added # --- BEGIN/END --- markers to ALL optional sections so feature
  #     flags (--no-X / no_X: true) actually work. Previously no markers existed
  #     so all feature flags were silently doing nothing against this template.
  #   - Added timer.garage_exit_eval wrapped in # --- BEGIN exit_eval --- block
  #   - Added restore_value: true to all input_number entries (without it, every
  #     HA restart resets numbers back to `initial`, wiping user-set values)
  #   - Renamed garage_fan_runon -> garage_actions_fan_runon for naming
  #     consistency (update automations referencing the old entity id)
  #   - Differentiated humidity icons: high=mdi:water-percent-alert, low=mdi:water-percent
  #   - Added restore: false explicitly on all timers
  #   - Added icons to all timers

  input_boolean:
    # NOTE: `initial` only sets the value on FIRST creation in the DB.
    # After that, HA restores the last known state from the recorder.

    garage_auto_lights_on:
      name: "Garage auto lights on (tag)"
      icon: mdi:lightbulb-auto
      initial: false

    garage_keep_on:
      name: "Garage keep on (block off)"
      icon: mdi:lock-open-variant-outline
      initial: false

    garage_auto_fan_on:
      name: "Garage auto fan on (tag)"
      icon: mdi:fan-auto
      initial: false

  input_datetime:
    # input_datetime always restores last value from recorder â€” no restore_value needed.

    garage_actions_night_start:
      name: "Garage night start"
      icon: mdi:weather-night
      has_date: false
      has_time: true
      initial: "22:00:00"

    garage_actions_night_end:
      name: "Garage night end"
      icon: mdi:weather-sunny
      has_date: false
      has_time: true
      initial: "06:00:00"

  input_number:
    # IMPORTANT: restore_value: true is set on ALL input_number helpers below.
    # Without it, HA resets every number back to `initial` on every restart,
    # silently wiping any value the user configured via the UI or automations.

    garage_actions_brightness_day_pct:
      name: "Garage brightness day %"
      icon: mdi:brightness-6
      unit_of_measurement: "%"
      min: 1
      max: 100
      step: 1
      mode: box
      initial: 60
      restore_value: true

    garage_actions_brightness_night_pct:
      name: "Garage brightness night %"
      icon: mdi:brightness-4
      unit_of_measurement: "%"
      min: 1
      max: 100
      step: 1
      mode: box
      initial: 10
      restore_value: true

    garage_actions_fan_pct_day:
      name: "Garage fan day %"
      icon: mdi:fan
      unit_of_measurement: "%"
      min: 0
      max: 100
      step: 5
      mode: box
      initial: 0
      restore_value: true

    garage_actions_fan_pct_night:
      name: "Garage fan night %"
      icon: mdi:fan
      unit_of_measurement: "%"
      min: 0
      max: 100
      step: 5
      mode: box
      initial: 0
      restore_value: true

    garage_actions_fan_runon_minutes:
      name: "Garage fan run-on (minutes)"
      icon: mdi:timer-outline
      unit_of_measurement: "min"
      min: 0
      max: 60
      step: 1
      mode: box
      initial: 5
      restore_value: true
      # NOTE: Keep in sync with timer.garage_actions_fan_runon duration below.

    garage_actions_fan_on_delay_seconds:
      name: "Garage fan ON delay (sec)"
      icon: mdi:timer-outline
      unit_of_measurement: "s"
      min: 0
      max: 180
      step: 5
      mode: box
      initial: 20
      restore_value: true

    garage_actions_lux_threshold:
      name: "Garage lux threshold"
      icon: mdi:weather-sunny-alert
      unit_of_measurement: "lx"
      min: 0
      max: 5000
      step: 1
      mode: box
      initial: 30
      restore_value: true

    garage_actions_humidity_high:
      name: "Garage humidity high %"
      icon: mdi:water-percent-alert
      unit_of_measurement: "%"
      min: 30
      max: 100
      step: 1
      mode: box
      initial: 65
      restore_value: true

    garage_actions_humidity_low:
      name: "Garage humidity low %"
      icon: mdi:water-percent
      unit_of_measurement: "%"
      min: 30
      max: 100
      step: 1
      mode: box
      initial: 55
      restore_value: true

  timer:
    garage_actions_cooldown:
      name: "Garage actions cooldown"
      icon: mdi:timer-pause-outline
      duration: "00:00:30"
      restore: false

    # Renamed from garage_fan_runon -> garage_actions_fan_runon for
    # consistency. Update any automations referencing the old entity id:
    #   timer.garage_fan_runon  ->  timer.garage_actions_fan_runon
    garage_actions_fan_runon:
      name: "Garage fan run-on"
      icon: mdi:fan-clock
      duration: "00:05:00"
      restore: false

    # Required by WITB+ v4.2. Drives the non-blocking door-open exit path.
    # When a door opens while occupied, this timer starts for exit_timeout_seconds.
    # Motion returning cancels it. When it fires, the automation re-evaluates
    # whether to clear occupancy.
    # Use no_exit_eval: true in your room config to exclude (e.g. rooms not
    # using WITB+ v4.2, or rooms with no transition doors).
    garage_exit_eval:
      name: "Garage exit eval"
      icon: mdi:door-open
      duration: "00:01:00"
      # NOTE: Duration is a fallback only. WITB+ v4.2 always calls timer.start
      # with an explicit duration from exit_timeout_seconds at runtime.
      restore: false
